## Markdown to PDF

Instantly convert GitHubâ€‘style Markdown (with KaTeX math) into highâ€‘quality PDFs.

The main site is deployed at **`https://markdown.kwon.ai`** and the source is hosted at `https://github.com/danieljbk/md2pdf`.

### What this project is

- **Markdown editor + live preview** with GitHubâ€‘style rendering.
- **Downloadable PDF export** via a **Cloudflare Browser Rendering Worker** (required for PDF downloads).
- Fully static Astro site for editing/preview; PDFs are generated by a small Cloudflare Worker.

---

## âœ¨ Features

- **Live GitHubâ€‘style preview**: Markdown is rendered with `marked` and `github-markdown-css` so what you see matches GitHubâ€™s typography.
- **Monaco editor**: Modern codeâ€‘editor experience with wordâ€‘wrap, syntax highlighting, and a custom Laetus theme.
- **KaTeX math**: Inline and block LaTeX (e.g. `\(x^2\)`, `$$x^2$$`) render both in preview and PDF.
- **Themes**: Switch between **Laetus Black**, **GitHub Dark**, and **GitHub Light**; preferences are saved in `localStorage`.
- **Layout controls**:
  - Draggable splitâ€‘pane between editor and preview.
  - Optional **scroll sync** between editor and preview.
  - **Reset** button to restore the default/example markdown.
- **Clipboard helpers**: Oneâ€‘click **Copy** button to copy the current Markdown to the clipboard.
- **Download (PDF)**:
  - If `PUBLIC_WORKER_PDF_URL` is set, the app calls a **Cloudflare Browser Rendering Worker** to generate a PDF with working links.
  - If not set, the button falls back to the **browser print dialog** (`window.print()`).

---

## ğŸ› ï¸ Tech Stack

- **Astro 5** â€“ Static site generator.
- **TypeScript** â€“ Frontend scripting.
- **monaco-editor** â€“ Inâ€‘browser editor.
- **marked** â€“ GitHubâ€‘flavored Markdown parser.
- **KaTeX** â€“ Clientâ€‘side LaTeX rendering.
- **github-markdown-css** â€“ GitHubâ€™s Markdown styles.
- **Cloudflare Pages** â€“ Static hosting (for the Astro site).
- **Cloudflare Workers + @cloudflare/puppeteer** â€“ Optional HTML â†’ PDF rendering worker.
- **Bun / Node.js** â€“ Package manager and runtime for local development.

---

## ğŸš€ Getting Started (Astro frontend)

### Prerequisites

- **Node.js** 18+ or **Bun** 1.0+.
- Any package manager (`bun`, `pnpm`, `npm`, or `yarn`). Examples below use **Bun**.

### Clone & install

```bash
git clone https://github.com/danieljbk/md2pdf.git
cd md2pdf

# Using Bun (recommended in this repo)
bun install
```

Or with Node:

```bash
npm install
```

### Run the dev server

```bash
# Bun
bun run dev

# or with npm
npm run dev
```

The site will be available at `http://localhost:4321` (Astroâ€™s default dev port).

### Build & preview production

```bash
# Build static files
bun run build

# Preview the production build locally
bun run preview
```

Equivalent `npm` commands (`npm run build`, `npm run preview`) also work.

---

## ğŸ“– Usage

1. **Start the dev server** (or open the deployed site).
2. **Type or paste Markdown** into the Monaco editor on the left.
3. The **preview updates automatically** as you type; you can also press **Ctrl/Cmd + Enter** to force a preview refresh.
4. Use **Sync scroll** if you want editor and preview to scroll together.
5. Click **Copy** to copy the current Markdown, or **Reset** to restore the default/example document.
6. Click **Download (PDF)**:
   - With a configured worker (`PUBLIC_WORKER_PDF_URL`), a PDF is generated by Cloudflare Browser Rendering and downloaded directly.
   - If no worker URL is configured, the **Download (PDF)** button is disabled and PDFs cannot be generated.

### Supported Markdown

- **Headings** `#`â€“`######`
- **Emphasis**: bold, italic, strikethrough
- **Links & images**
- **Inline code & fenced code blocks**
- **Ordered & unordered lists**
- **Tables**
- **Blockquotes**
- **Horizontal rules**
- **KaTeX math**:
  - Inline: `$...$`, `\(...\)`
  - Block: `$$...$$`, `\[...\]`

### Known limitations

- Very large documents are still rendered inâ€‘browser; extremely big files may feel slow.
- For workerâ€‘based PDFs, external assets (images, fonts) must be reachable from Cloudflareâ€™s environment.

---

## ğŸ§© PDF Worker (Cloudflare Browser Rendering)

This repo includes a **Cloudflare Worker** that uses **Browser Rendering (Puppeteer)** to turn rendered Markdown HTML into a highâ€‘quality, textâ€‘based PDF with working links. All PDF downloads from the UI go through this worker.

- Worker source lives in `worker/` (see its own `README.md` and `docs/BROWSER-RENDERING-WORKER.md`).
- The worker exposes a `POST /render-pdf` (or `/`) endpoint that accepts:

```json
{
  "html": "<!doctype html>...complete html string...",
  "filename": "markdown-YYYY-MM-DD.pdf"
}
```

### Running the worker locally

```bash
cd worker

# Install worker-specific deps (pnpm / npm / bun are all fine)
pnpm install   # or npm install / bun install

# Start the worker in dev mode
npx wrangler dev
```

### Connecting the frontend to the worker

Configure the public worker URL via an Astro public env var:

```bash
# .env.local (for local development)
PUBLIC_WORKER_PDF_URL="https://your-worker-subdomain.workers.dev/render-pdf"
```

Then rebuild / restart the Astro dev server. The **Download (PDF)** button will now:

1. Serialize the current preview HTML into a minimal HTML document.
2. POST it as `{ html, filename }` to `PUBLIC_WORKER_PDF_URL`.
3. Download the resulting `application/pdf` as a file like `markdown-2025-11-15.pdf`.

If `PUBLIC_WORKER_PDF_URL` is not set, the **Download (PDF)** button is disabled and PDF downloads are unavailable.

---

## ğŸ“¦ Deployment

The Astro frontend is a static site and can be deployed to any static host (Cloudflare Pages, Netlify, Vercel, S3, etc.).

### Cloudflare Pages (example)

1. Push the repo (e.g. `md2pdf`) to GitHub.
2. In the Cloudflare dashboard, create a **Pages** project and connect the repo.
3. Configure build settings:
   - **Build command**: `bun run build` (or `npm run build`).
   - **Build output directory**: `dist`.
   - **Framework preset**: Astro.
4. Optionally set environment variables:
   - `PUBLIC_WORKER_PDF_URL` â€“ URL of your deployed Browser Rendering Worker.
5. Deploy.

The worker in `worker/` is deployed separately using `wrangler deploy` (see `worker/README.md`).

---

## ğŸ’° Cost

- **Astro frontend**:
  - Static hosting on Cloudflare Pages is typically **$0** for common usage.
  - No database required.
- **Browser Rendering Worker**:
  - Billed per **browserâ€‘hour**; each PDF render usually takes a couple of seconds.
  - In practice this is inexpensive (order of a few dollars per tens of thousands of PDFs), but it is **not free**.

You can still deploy the site without the worker if you only need the editor + HTML preview, but **PDF downloads require a configured worker**.

---

## ğŸ¯ Project Structure

```text
md2pdf/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ MarkdownConverter.astro   # Main UI shell (editor + preview + header)
â”‚   â”œâ”€â”€ layouts/
â”‚   â”‚   â””â”€â”€ Layout.astro              # Base HTML layout and global styles
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â””â”€â”€ index.astro               # Homepage wiring layout â†’ converter
â”‚   â””â”€â”€ scripts/
â”‚       â””â”€â”€ markdown-converter.ts     # Monaco editor, theming, PDF worker integration
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ example.md                    # Example markdown loaded on first visit
â”‚   â”œâ”€â”€ laetus-blk-color-theme.json   # Monaco theme definition
â”‚   â””â”€â”€ icons / fonts / manifest / og-image
â”œâ”€â”€ worker/
â”‚   â”œâ”€â”€ src/worker.ts                 # Cloudflare Browser Rendering worker
â”‚   â”œâ”€â”€ wrangler.toml                 # Worker configuration
â”‚   â””â”€â”€ docs/BROWSER-RENDERING-WORKER.md
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ rules/CLIENT-SCRIPTS-AND-TYPESCRIPT.md
â”‚   â””â”€â”€ markdownlivepreview/          # Legacy Markdown Live Preview assets & docs
â”œâ”€â”€ astro.config.mjs
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

---

## ğŸ¤ Contributing

Bug reports, feature ideas, and pull requests are very welcome.

If youâ€™re making larger changes (especially to the worker or PDF layout), consider opening an issue first so we can align on direction.

---

## ğŸ“„ License

MIT License â€“ feel free to use this project for personal or commercial work, with attribution.

---

## ğŸ™ Acknowledgments

- **Astro** â€“ Static site generator.
- **marked** â€“ Markdown parser.
- **KaTeX** â€“ LaTeX rendering.
- **github-markdown-css** â€“ GitHubâ€™s Markdown styles.
- **monaco-editor** â€“ Inâ€‘browser editor.
- **Cloudflare Workers + Browser Rendering** â€“ HTML â†’ PDF rendering.

---

Built with â¤ï¸ using Astro, KaTeX, marked, Monaco, and Cloudflare.
